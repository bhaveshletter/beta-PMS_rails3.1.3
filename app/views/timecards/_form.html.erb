<%= form_for(@timecard) do |f| %>
  <% if @timecard.errors.any? %>
    <div id="errorExplanation">
      <h2><%= pluralize(@timecard.errors.count, "error") %> prohibited this post from being saved :</h2>
      <ul>
        <% @timecard.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <span class="project_select controls"><%= f.select :project_id, @assigned_projects.map{|c| [c.name, c.id]}, :prompt => 'Please Select Project' %>
    </span>
    <div class="task_select controls"><%#= f.select :task_id, @assign_tasks.map{|c| [c.name, c.id]}, {:include_blank => true, :selected => f.object.project_id} , :prompt => 'Please Select task' %>
  <%#= f.select :task_id, options_for_select(Task.where(["project_id = ?",f.object.project_id]).map{|t| [t.name,t.id]}), :prompt => "Please Select Task" %>
    </div>
  </div>
  <div class="field">
    <%= f.text_area :description, :size=>"28x3", :placeholder => "Description" %>
  </div>
  <div class="field">
    <%= f.text_field :time_duration, :placeholder => "Duration of the Time", :size => "15", :onblur=>"validateTime(this)" %><span style="color:lightslategray;font-size:small;"> HH:MM(Example: 02:30 Which means 02 hours and 30 minute)</span>
  </div>
  <div class="field">
    <%= f.select :role, Timecard::ROLE, :placeholder => "Role of the Project" %>
  </div>
  <div class="actions">
    <%= f.submit %>
  </div>
<% end %>






<script TYPE="text/JavaScript">
  function validateTime(obj)
  {
    var timeValue = obj.value;
    if(timeValue == "" || timeValue.indexOf(":")<0)
    {
      alert("Invalid Time format");
      // obj.style.backgroundColor = '#fba';
      return false;
    }
    else
    {
      var sHours = timeValue.split(':')[0];
      var sMinutes = timeValue.split(':')[1];

      if(sHours == "" || isNaN(sHours) || parseInt(sHours)>23)
      {
        alert("Invalid Time format");
        //obj.style.backgroundColor = '#fba';
        return false;
      }
      else if(parseInt(sHours) == 0)
        sHours = "00";
      //  else if (sHours <10)
      else if (parseInt(sHours) < 10 && sHours.length < 2)
        sHours = "0"+sHours;

      if(sMinutes == "" || isNaN(sMinutes) || parseInt(sMinutes)>59)
      {
        alert("Invalid Time format");
        //  obj.style.backgroundColor = '#fba';
        return false;
      }
      else if(parseInt(sMinutes) == 0)
        sMinutes = "00";
      //  else if (sMinutes <10)
      else if (parseInt(sMinutes) < 10 && sMinutes.length < 2 )
        sMinutes = "0"+sMinutes;

      obj.value = sHours + ":" + sMinutes;
    }

    return true;
  }


  // project select task list with ajax

  $('.project_select select').change(function() {
    url = "/task_list/" + $(this).val();
    $.getScript(url, function(data) {
      /* $('.result').html(data); */
      /* alert('Load was performed.'); */
    });
  });



</script>