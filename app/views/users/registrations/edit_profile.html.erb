<h3>Edit User Profile</h3>

<%= form_for(@user, :url => update_profile_user_registration_path, :html => {:multipart => true, :method => :put }) do |f| %>
  <%= devise_error_messages! %>
  <div> <%= f.email_field :email, :readonly => "true" %> * </div>

  <% if current_user.avatar.exists? then %>
    <div class = "img_temp"> <%= image_tag current_user.avatar.url(:thumb) %> </div>
  <% else %>
    <div class = "img_temp"> <%= image_tag('/assets/no-image.gif', :id => 'user_avatar') %> </div>
  <% end %>
  <div> <%= f.file_field :avatar, :onchange => "imgPreview(this);" %> </div>

  <div><%= f.submit "Update Profile" %></div>
<% end %>

<%= link_to "Back", :back %>


<script type="text/javascript">
  /* START image preview when press upload button */
  var reader = new FileReader();
  function imgPreview(input) {   
    if (input.files && input.files[0]) {
      var reader = new FileReader();
      reader.onload = function (e) {
        $('img').attr('id', $(input).attr("id")).remove();
        $('div.img_temp').append('<img src="" height = "75px" width = "75px" id ='+ $(input).attr("id") +' />');
        $('img[id="'+$(input).attr("id")+'"]').attr('src', e.target.result);
      }
      reader.readAsDataURL(input.files[0]);
    }
  }
  /* END image preview when press upload button */
</script>
